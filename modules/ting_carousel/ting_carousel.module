<?php
/**
 * @file
 * Carousel elements.
 */

/**
 * Implements hook_theme().
 */
function ting_carousel_theme($existing, $type, $theme, $path) {
  return array(
    'ting_carousel' => array(
      'variables' => array(
        'items' => array(),
        'item_type' => 'ting_object',
        'args' => array(),
      ),
      'file' => 'ting_carousel.theme.inc',
    ),
  );
}

/**
 * Implements hook_field_formatter_info().
 */
function ting_carousel_field_formatter_info() {
  return array(
    'ting_carousel' => array(
      'label' => t('Ting Carousel'),
      'field types' => array('ting_reference'),
      'settings' => array(
        'view_mode' => 'teaser',
      ),
    ),
  );
}

/**
 * Implements hook_field_formatter_settings_form().
 */
function ting_carousel_field_formatter_settings_form($field, $instance, $view_mode, $form, $form_state) {
  $instance['display'][$view_mode]['type'] = 'ting_reference_default';
  return ting_reference_field_formatter_settings_form($field, $instance, $view_mode, $form, $form_state);
}

/**
 * Implements hook_field_formatter_settings_summary().
 */
function ting_carousel_field_formatter_settings_summary($field, $instance, $view_mode) {
  $instance['display'][$view_mode]['type'] = 'ting_reference_default';
  return ting_reference_field_formatter_settings_summary($field, $instance, $view_mode);
}

/**
 * Implements hook_field_formatter_view().
 */
function ting_carousel_field_formatter_view($entity_type, $entity, $field, $instance, $langcode, $items, $display) {
  $display['type'] = 'ting_reference_default';
  return ting_reference_field_formatter_view($entity_type, $entity, $field, $instance, $langcode, $items, $display);
}

/**
 * Implements hook_preprocess_field().
 */
function ting_carousel_preprocess_field(&$variables) {
  if ($variables['element']['#formatter'] === 'ting_carousel') {
    ting_carousel_add_externals();
    $variables['classes_array'][] = 'ting-carousel-field';
  }
}

/**
 * Add all the js and css needed for the carousel to work.
 */
function ting_carousel_add_externals() {
  $module_path = drupal_get_path('module', 'ting_carousel');
  $slick_path = $module_path . '/slick';
  drupal_add_js($slick_path . '/slick.min.js');
  drupal_add_js($module_path . '/js/ting-carousel.js');
  drupal_add_css($slick_path . '/slick.ccs');
}