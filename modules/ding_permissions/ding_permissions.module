<?php
/**
 * @file
 * Module file for secure permissions in code.
 */

include_once 'ding_permissions.features.inc';

/**
 * Implements hook_menu_alter().
 *
 * Alters the user edit menu path to ensure that only the right roles can edit
 * the other users. E.g the local administrator role should not be able to
 * change the profile of an administrator, but do to Drupal only have one
 * permission "administer users" we are not able to control this.
 */
function ding_permissions_menu_alter(&$items) {
  $items['user/%user/edit']['access callback'] = 'ding_permissions_user_access_level';
  $items['user/%user/roles']['access callback'] = 'ding_permission_check_roles_access';
  $items['user/%user/roles']['access arguments'] = array(1);
}

/**
 * Implements hook_permission().
 *
 * Defines the new user edit permission based on user role id's.
 *
 * @see ding_permissions_menu_alter()
 */
function ding_permissions_permission() {
  $permissions = array();

  // Get all roles.
  $roles = user_roles(TRUE);

  // Add edit permission for each role.
  foreach ($roles as $rid => $role) {
    // Create a new permission for each user role.
    $permissions['administer user role ' . $rid] = array(
      'title' => t('Administer user with role: %role', array('%role' => $role)),
      'description' => t('Edit user with this role.'),
    );
  }

  return $permissions;
}

/**
 * Access callback that checks user has access to edit profile.
 *
 * Next calls to check that the user is allowed to edit roles and thereby
 * having the roles tab shown.
 *
 * @param Object $account
 *   The user being edited.
 *
 * @see ding_permissions_menu_alter()
 *
 * @return bool
 *   If the user is allowed to edit the account TRUE is returned else FALSE.
 */
function ding_permissions_user_access_level($account) {
  // We don't allow anonymous to edit users.
  if ($account->uid) {
    // Allow users to edit own profile.
    if ($GLOBALS['user']->uid == $account->uid) {
      return TRUE;
    }
    else {
      return ding_permission_check_roles_access($account);
    }
  }

  return FALSE;
}

/**
 * Access callback that checks user role edit permissions.
 *
 * @param Object $account
 *   The user being edited.
 *
 * @see ding_permissions_menu_alter()
 *
 * @return bool
 *   If the user is allowed to edit the account TRUE is returned else FALSE.
 */
function ding_permission_check_roles_access($account) {
  // Check that the user have "administer users" permission.
  if (user_access('administer users')) {
    // Get the roles of the account we are trying to edit.
    $rids = array_keys($account->roles);
    foreach ($rids as $rid) {
      // Check if the user logged in has permission to edit the accounts
      // role. If we are allowed to edit just one of the roles access is
      // granted.
      if (user_access('administer user role ' . $rid)) {
        return TRUE;
      }
    }
  }

  return FALSE;
}

/**
 * Define site roles in code.
 *
 * Create a secure_permissions_data module directory and place this function
 * in secure_permissions_data.module.
 *
 * @return array
 *   An array defining all the roles for the site.
 */
function ding_permissions_secure_permissions_roles() {
  return array(
    'anonymous user',
    'authenticated user',
    'editor',
    'guest blogger',
    'local administrator',
    'local editor',
    'provider',
    'staff',
    'administrators',
    'user administrator',
  );
}

/**
 * Define site permissions in code.
 *
 * Create a secure_permissions_data module directory and place this function
 * in secure_permissions_data.module.
 *
 * @param string $role
 *   The role for which the permissions are being requested.
 *
 * @return array
 *   An array defining all the permissions for the site.
 */
function ding_permissions_secure_permissions($role) {
  $permissions = array(
    // Permissions to disable that aren't assigned to any roles.
      0 => array(
    ),
    'anonymous user' => array(
      'access comments',
      'access content',
      'access site-wide contact form',
      'access user profiles',
      'display EU Cookie Compliance popup',
      'perform reservation',
      'search content',
      'view any ding_staff_profile profile',
      'view files',
    ),
    'authenticated user' => array(
      'access comments',
      'access content',
      'access environment indicator',
      'access environment indicator development',
      'access environment indicator default_environment',
      'access environment indicator staging',
      'access environment indicator overwritten_environment',
      'access site-wide contact form',
      'access user profiles',
      'display EU Cookie Compliance popup',
      'edit own comments',
      'post comments',
      'search content',
      'skip comment approval',
      'view any ding_staff_profile profile',
      'view files',
      'view own ding_staff_profile profile',
      'view own files',
      'view own private files',
      'use personalisation',
    ),
    'administrators' => array(
      'access media browser',
      'use media wysiwyg',
      'administer serendipity panes',
      'access administration pages',
      'access administration menu',
      'flush caches',
      'access all views',
      'access all webform results',
      'access campaign rules',
      'access comments',
      'access content',
      'access content overview',
      'access contextual links',
      'access environment indicator',
      'access environment indicator development',
      'access environment indicator default_environment',
      'access environment indicator staging',
      'access environment indicator overwritten_environment',
      'access overlay',
      'access own webform content',
      'access own webform results',
      'access own webform submissions',
      'access relations',
      'access rules debug',
      'access site in maintenance mode',
      'access site reports',
      'access site-wide contact form',
      'access the block administration page',
      'access toolbar',
      'access user contact forms',
      'access user profiles',
      'access workbench',
      'add media from remote sources',
      'administer actions',
      'administer advanced pane settings',
      'administer autologout',
      'administer block access settings',
      'administer blocks',
      'administer bpi',
      'administer comments',
      'administer contact forms',
      'administer content types',
      'administer custom content',
      'administer ddb_cp',
      'administer dibs settings',
      'administer dibs transactions',
      'administer ding provider',
      'administer EU Cookie Compliance popup',
      'administer environment indicator settings',
      'administer event settings',
      'administer news settings',
      'administer eresource settings',
      'administer user settings',
      'administer social links settings',
      'administer fe promote',
      'administer features',
      'administer fieldgroups',
      'administer fields',
      'administer file types',
      'administer files',
      'administer filters',
      'administer flags',
      'administer group',
      'administer image styles',
      'administer languages',
      'administer media browser',
      'administer menu',
      'administer menu positions',
      'administer meta tags',
      'administer module filter',
      'administer modules',
      'administer nodequeue',
      'administer nodes',
      'administer og menu',
      'administer og menu configuration',
      'administer opening hours configuration',
      'administer page manager',
      'administer pane access',
      'administer panel-nodes',
      'administer panels layouts',
      'administer panels styles',
      'administer pathauto',
      'administer permissions',
      'administer place2book settings',
      'administer profile types',
      'administer profiles',
      'administer realname',
      'administer redirects',
      'administer relation types',
      'administer relations',
      'administer rules',
      'administer scheduler',
      'administer search',
      'administer shortcuts',
      'administer site configuration',
      'administer software updates',
      'administer taxonomy',
      'administer themes',
      'administer ting settings',
      'administer tipsy',
      'administer url aliases',
      'administer user role 1',
      'administer user role 2',
      'administer user role 3',
      'administer user role 4',
      'administer user role 5',
      'administer user role 6',
      'administer user role 7',
      'administer user role 8',
      'administer user role 9',
      'administer users',
      'administer uuid',
      'administer varnish',
      'administer views',
      'administer workbench',
      'administer workflow',
      'assign administrators role',
      'assign all roles',
      'assign anonymous user role',
      'assign editor role',
      'assign guest blogger role',
      'assign local administrator role',
      'assign local editor role',
      'assign provider role',
      'assign staff role',
      'block IP addresses',
      'bpi push content',
      'bpi syndicate content',
      'bypass file access',
      'bypass node access',
      'bypass rules access',
      'cancel account',
      'change layouts in place editing',
      'change own logout threshold',
      'change own username',
      'clone node',
      'clone own nodes',
      'create ding_campaign content',
      'configure all block body fields',
      'configure all block descriptions',
      'configure all block titles',
      'configure all blocks',
      'configure all content type visibility settings',
      'configure all language settings',
      'configure all page visibility settings',
      'configure all region settings',
      'configure all role visibility settings',
      'configure all user visibility settings',
      'configure all visibility settings',
      'configure carousel',
      'configure gatewayf',
      'Configure WAYF',
      'create blocks',
      'create ding_event content',
      'create ding_group content',
      'create ding_library content',
      'create ding_news content',
      'create ding_page content',
      'create ding_rolltab content',
      'create files',
      'create panel content',
      'create panel-nodes',
      'create relations',
      'create url aliases',
      'create webform content',
      'create ding_eresource content',
      'customize shortcut links',
      'delete all blocks',
      'delete all webform submissions',
      'delete any audio files',
      'delete any ding_campaign content',
      'delete any ding_event content',
      'delete any ding_group content',
      'delete any ding_library content',
      'delete any ding_news content',
      'delete any ding_page content',
      'delete any ding_rolltab content',
      'delete any document files',
      'delete any image files',
      'delete any panel content',
      'delete any panel-nodes',
      'delete any video files',
      'delete any webform content',
      'delete any ding_eresource content',
      'delete bpi content',
      'delete own audio files',
      'delete own ding_campaign content',
      'delete own ding_event content',
      'delete own ding_group content',
      'delete own ding_library content',
      'delete own ding_news content',
      'delete own ding_page content',
      'delete own ding_rolltab content',
      'delete own document files',
      'delete own image files',
      'delete own panel content',
      'delete own panel-nodes',
      'delete own video files',
      'delete own webform content',
      'delete own webform submissions',
      'delete own ding_eresource content',
      'delete relations',
      'delete revisions',
      'delete terms in 1',
      'delete terms in 2',
      'delete terms in 3',
      'delete terms in 4',
      'delete terms in 5',
      'delete terms in 6',
      'delete terms in 7',
      'disable all blocks',
      'download any audio files',
      'download any document files',
      'download any image files',
      'download any video files',
      'download own audio files',
      'download own document files',
      'download own image files',
      'download own video files',
      'dynamic background configure default',
      'dynamic background upload default',
      'dynamic backgrounds css callback',
      'dynamic backgrounds set default',
      'dynamic backgrounds weight',
      'eck add ting_covers_custom cover entities',
      'eck edit ting_covers_custom cover entities',
      'eck delete ting_covers_custom cover entities',
      'eck list ting_covers_custom cover entities',
      'edit all webform submissions',
      'edit any audio files',
      'edit any ding_campaign content',
      'edit any ding_event content',
      'edit any ding_group content',
      'edit any ding_library content',
      'edit any ding_news content',
      'edit any ding_page content',
      'edit any ding_rolltab content',
      'edit any ding_staff_profile profile',
      'edit any document files',
      'edit any image files',
      'edit any panel content',
      'edit any panel-nodes',
      'edit any provider_alma profile',
      'edit any video files',
      'edit any webform content',
      'edit any ding_eresource content',
      'edit meta tags',
      'edit opening hours for content',
      'edit own audio files',
      'edit own comments',
      'edit own ding_campaign content',
      'edit own ding_event content',
      'edit own ding_group content',
      'edit own ding_library content',
      'edit own ding_news content',
      'edit own ding_page content',
      'edit own ding_rolltab content',
      'edit own document files',
      'edit own image files',
      'edit own panel content',
      'edit own panel-nodes',
      'edit own video files',
      'edit own webform content',
      'edit own webform submissions',
      'edit own ding_eresource content',
      'edit relations',
      'edit terms in 1',
      'edit terms in 2',
      'edit terms in 3',
      'edit terms in 4',
      'edit terms in 5',
      'edit terms in 6',
      'edit terms in 7',
      'edit webform components',
      'edit workflow comment',
      'export nodes',
      'export own nodes',
      'enable all blocks',
      'export relation types',
      'export secure permissions',
      'generate features',
      'geocoder_service_all_handlers',
      'geocoder_service_handler_exif',
      'geocoder_service_handler_google',
      'geocoder_service_handler_gpx',
      'geocoder_service_handler_json',
      'geocoder_service_handler_kml',
      'geocoder_service_handler_latlon',
      'geocoder_service_handler_mapquest_nominatim',
      'geocoder_service_handler_wkt',
      'geocoder_service_handler_yahoo',
      'geocoder_service_handler_yandex',
      'manage features',
      'manipulate all queues',
      'manipulate queues',
      'move all blocks',
      'notify of path changes',
      'participate in workflow',
      'pay using dibs',
      'post comments',
      'revert revisions',
      'schedule publishing of nodes',
      'schedule workflow transitions',
      'search content',
      'select account cancellation method',
      'show workflow state form',
      'skip comment approval',
      'switch shortcut sets',
      'translate admin strings',
      'translate content',
      'translate interface',
      'translate user-defined strings',
      'use advanced search',
      'use flag import',
      'use ipe with page manager',
      'use IPE filter menu',
      'use page manager',
      'use panels caching features',
      'use panels dashboard',
      'use panels in place editing',
      'use panels locks',
      'use PHP to import nodes',
      'use text format ding_wysiwyg',
      'view all blocks',
      'view any ding_staff_profile profile',
      'view any provider_alma profile',
      'view any unpublished content',
      'view any provider_openruth profile',
      'view any unpublished ding_event content',
      'view any unpublished ding_group content',
      'view any unpublished ding_library content',
      'view any unpublished ding_news content',
      'view any unpublished ding_page content',
      'view any unpublished ding_rolltab content',
      'view any unpublished panel content',
      'view bpi statistics',
      'view files',
      'view own ding_staff_profile profile',
      'view own files',
      'view own private files',
      'view own unpublished content',
      'view pane admin links',
      'view private files',
      'view revisions',
      'view scheduled content',
      'view the administration theme',
      'administer personalisation',
    ),
    'editor' => array(
      'access media browser',
      'use media wysiwyg',
      'eck add ding_type ding_interaction entities',
      'eck edit ding_type ding_interaction entities',
      'eck delete ding_type ding_interaction entities',
      'eck list ding_type ding_interaction entities',
      'eck view ding_type ding_interaction entities',
      'access administration menu',
      'access all webform results',
      'access campaign rules',
      'access content overview',
      'access contextual links',
      'access environment indicator',
      'access environment indicator development',
      'access environment indicator default_environment',
      'access environment indicator staging',
      'access environment indicator overwritten_environment',
      'access site-wide contact form',
      'access overlay',
      'access own webform results',
      'access own webform submissions',
      'access toolbar',
      'access workbench',
      'add media from remote sources',
      'administer bpi',
      'administer contact forms',
      'administer menu',
      'administer opening hours configuration',
      'administer place2book settings',
      'administer shortcuts',
      'administer url aliases',
      'assign editor role',
      'assign guest blogger role',
      'assign local editor role',
      'assign staff role',
      'bpi push content',
      'bpi syndicate content',
      'clone node',
      'clone own nodes',
      'configure carousel',
      'create ding_campaign content',
      'create ding_event content',
      'create ding_group content',
      'create ding_library content',
      'create ding_news content',
      'create ding_page content',
      'create ding_rolltab content',
      'create files',
      'create url aliases',
      'create webform content',
      'create ding_eresource content',
      'customize shortcut links',
      'delete any audio files',
      'delete any ding_campaign content',
      'delete any ding_event content',
      'delete any ding_group content',
      'delete any ding_library content',
      'delete any ding_news content',
      'delete any ding_page content',
      'delete any ding_rolltab content',
      'delete any document files',
      'delete any image files',
      'delete any video files',
      'delete any webform content',
      'delete any ding_eresource content',
      'delete bpi content',
      'delete own audio files',
      'delete own ding_campaign content',
      'delete own ding_event content',
      'delete own ding_group content',
      'delete own ding_library content',
      'delete own ding_news content',
      'delete own ding_page content',
      'delete own ding_rolltab content',
      'delete own document files',
      'delete own image files',
      'delete own video files',
      'delete own webform content',
      'delete own ding_eresource content',
      'delete revisions',
      'delete terms in 1',
      'delete terms in 2',
      'delete terms in 3',
      'delete terms in 4',
      'delete terms in 5',
      'delete terms in 6',
      'delete terms in 7',
      'download any audio files',
      'download any document files',
      'download any image files',
      'download any video files',
      'download own audio files',
      'download own document files',
      'download own image files',
      'download own video files',
      'dynamic background upload default',
      'dynamic backgrounds css callback',
      'dynamic backgrounds set default',
      'dynamic backgrounds weight',
      'edit any audio files',
      'edit any ding_campaign content',
      'edit any ding_event content',
      'edit any ding_group content',
      'edit any ding_library content',
      'edit any ding_news content',
      'edit any ding_page content',
      'edit any ding_rolltab content',
      'edit any document files',
      'edit any image files',
      'edit any video files',
      'edit any webform content',
      'edit any ding_eresource content',
      'edit opening hours for content',
      'edit own audio files',
      'edit own ding_campaign content',
      'edit own ding_event content',
      'edit own ding_group content',
      'edit own ding_library content',
      'edit own ding_news content',
      'edit own ding_page content',
      'edit own ding_rolltab content',
      'edit own document files',
      'edit own image files',
      'edit own video files',
      'edit own webform content',
      'edit own ding_eresource content',
      'edit terms in 1',
      'edit terms in 2',
      'edit terms in 3',
      'edit terms in 4',
      'edit terms in 5',
      'edit terms in 6',
      'edit terms in 7',
      'edit webform components',
      'manipulate all queues',
      'manipulate queues',
      'notify of path changes',
      'participate in workflow',
      'revert revisions',
      'schedule publishing of nodes',
      'show workflow state form',
      'switch shortcut sets',
      'translate admin strings',
      'translate content',
      'translate interface',
      'translate user-defined strings',
      'use text format ding_wysiwyg',
      'view any unpublished content',
      'view bpi statistics',
      'view own unpublished content',
      'view revisions',
      'view the administration theme',
    ),
    'guest blogger' => array(
      'access media browser',
      'use media wysiwyg',
      'access administration menu',
      'access environment indicator',
      'access environment indicator development',
      'access environment indicator default_environment',
      'access environment indicator staging',
      'access environment indicator overwritten_environment',
      'access overlay',
      'access site-wide contact form',
      'access toolbar',
      'access workbench',
      'administer user role 5',
      'bpi push content',
      'bpi syndicate content',
      'clone node',
      'clone own nodes',
      'create ding_news content',
      'create files',
      'delete bpi content',
      'download own audio files',
      'download own document files',
      'download own image files',
      'download own video files',
      'edit own audio files',
      'edit own ding_news content',
      'edit own document files',
      'edit own image files',
      'edit own video files',
      'schedule publishing of nodes',
      'show workflow state form',
      'use text format ding_wysiwyg',
      'view own private files',
      'view own unpublished content',
      'view the administration theme',
    ),
    'local administrator' => array(
      'access media browser',
      'use media wysiwyg',
      'eck add ding_type ding_interaction entities',
      'eck edit ding_type ding_interaction entities',
      'eck delete ding_type ding_interaction entities',
      'eck list ding_type ding_interaction entities',
      'eck view ding_type ding_interaction entities',
      'access administration pages',
      'access administration menu',
      'flush caches',
      'access all webform results',
      'access campaign rules',
      'access content overview',
      'access environment indicator',
      'access environment indicator development',
      'access environment indicator default_environment',
      'access environment indicator staging',
      'access environment indicator overwritten_environment',
      'access site-wide contact form',
      'access contextual links',
      'access overlay',
      'access own webform results',
      'access own webform submissions',
      'access site in maintenance mode',
      'access toolbar',
      'access workbench',
      'add media from remote sources',
      'administer autologout',
      'administer bpi',
      'administer comments',
      'administer contact forms',
      'administer ddb_cp',
      'administer dibs settings',
      'administer dibs transactions',
      'administer ding provider',
      'administer EU Cookie Compliance popup',
      'administer event settings',
      'administer news settings',
      'administer eresource settings',
      'administer user settings',
      'administer social links settings',
      'administer fe promote',
      'administer files',
      'administer menu',
      'administer meta tags',
      'administer nodes',
      'administer opening hours configuration',
      'administer redirects',
      'administer place2book settings',
      'administer search',
      'administer shortcuts',
      'administer site configuration',
      'administer taxonomy',
      'administer themes',
      'administer ting settings',
      'administer url aliases',
      'administer user role 4',
      'administer user role 5',
      'administer user role 6',
      'administer user role 7',
      'administer user role 9',
      'administer users',
      'assign editor role',
      'assign guest blogger role',
      'assign local administrator role',
      'assign local editor role',
      'assign staff role',
      'bpi push content',
      'bpi syndicate content',
      'cancel account',
      'change own username',
      'configure carousel',
      'Configure WAYF',
      'clone node',
      'clone own nodes',
      'create ding_campaign content',
      'create ding_event content',
      'create ding_group content',
      'create ding_library content',
      'create ding_news content',
      'create ding_page content',
      'create ding_rolltab content',
      'create files',
      'configure gatewayf',
      'create url aliases',
      'create webform content',
      'create ding_eresource content',
      'customize shortcut links',
      'delete any audio files',
      'delete any ding_campaign content',
      'delete any ding_event content',
      'delete any ding_group content',
      'delete any ding_library content',
      'delete any ding_news content',
      'delete any ding_page content',
      'delete any ding_rolltab content',
      'delete any document files',
      'delete any image files',
      'delete any video files',
      'delete any webform content',
      'delete any ding_eresource content',
      'delete bpi content',
      'delete own audio files',
      'delete own ding_campaign content',
      'delete own ding_event content',
      'delete own ding_group content',
      'delete own ding_library content',
      'delete own ding_news content',
      'delete own ding_page content',
      'delete own ding_rolltab content',
      'delete own document files',
      'delete own image files',
      'delete own video files',
      'delete own webform content',
      'delete own ding_eresource content',
      'delete revisions',
      'delete terms in 1',
      'delete terms in 2',
      'delete terms in 3',
      'delete terms in 4',
      'delete terms in 5',
      'delete terms in 6',
      'delete terms in 7',
      'download any audio files',
      'download any document files',
      'download any image files',
      'download any video files',
      'download own audio files',
      'download own document files',
      'download own image files',
      'download own video files',
      'dynamic background upload default',
      'dynamic backgrounds css callback',
      'dynamic backgrounds set default',
      'dynamic backgrounds weight',
      'eck add ting_covers_custom cover entities',
      'eck edit ting_covers_custom cover entities',
      'eck delete ting_covers_custom cover entities',
      'eck list ting_covers_custom cover entities',
      'edit any audio files',
      'edit any ding_campaign content',
      'edit any ding_event content',
      'edit any ding_group content',
      'edit any ding_library content',
      'edit any ding_news content',
      'edit any ding_page content',
      'edit any ding_rolltab content',
      'edit any ding_staff_profile profile',
      'edit any document files',
      'edit any image files',
      'edit any video files',
      'edit any webform content',
      'edit any ding_eresource content',
      'edit meta tags',
      'edit opening hours for content',
      'edit own audio files',
      'edit own ding_campaign content',
      'edit own ding_event content',
      'edit own ding_group content',
      'edit own ding_library content',
      'edit own ding_news content',
      'edit own ding_page content',
      'edit own ding_rolltab content',
      'edit own document files',
      'edit own image files',
      'edit own video files',
      'edit own webform content',
      'edit own ding_eresource content',
      'edit terms in 1',
      'edit terms in 2',
      'edit terms in 3',
      'edit terms in 4',
      'edit terms in 5',
      'edit terms in 6',
      'edit terms in 7',
      'edit webform components',
      'edit workflow comment',
      'manipulate all queues',
      'manipulate queues',
      'notify of path changes',
      'participate in workflow',
      'revert revisions',
      'schedule publishing of nodes',
      'show workflow state form',
      'switch shortcut sets',
      'translate admin strings',
      'translate content',
      'translate interface',
      'translate user-defined strings',
      'use advanced search',
      'use ipe with page manager',
      'use IPE filter menu',
      'use panels in place editing',
      'use text format ding_wysiwyg',
      'view any provider_alma profile',
      'view any provider_openruth profile',
      'view any unpublished content',
      'view bpi statistics',
      'view own unpublished content',
      'view pane admin links',
      'view private files',
      'view revisions',
      'view scheduled content',
      'view the administration theme',
      'administer personalisation',
    ),
    'local editor' => array(
      'access media browser',
      'use media wysiwyg',
      'eck add ding_type ding_interaction entities',
      'eck edit ding_type ding_interaction entities',
      'eck delete ding_type ding_interaction entities',
      'eck list ding_type ding_interaction entities',
      'eck view ding_type ding_interaction entities',
      'access administration menu',
      'access campaign rules',
      'access content overview',
      'access contextual links',
      'access environment indicator',
      'access environment indicator development',
      'access environment indicator default_environment',
      'access environment indicator staging',
      'access environment indicator overwritten_environment',
      'access site-wide contact form',
      'access overlay',
      'access toolbar',
      'access workbench',
      'add media from remote sources',
      'administer contact forms',
      'administer menu',
      'administer shortcuts',
      'administer user role 4',
      'administer user role 5',
      'administer user role 7',
      'bpi push content',
      'bpi syndicate content',
      'clone node',
      'clone own nodes',
      'configure carousel',
      'create ding_event content',
      'create ding_news content',
      'create ding_page content',
      'create files',
      'customize shortcut links',
      'delete any ding_event content',
      'delete bpi content',
      'delete own ding_event content',
      'delete own ding_news content',
      'delete own ding_page content',
      'delete terms in 2',
      'download own audio files',
      'download own document files',
      'download own image files',
      'download own video files',
      'edit any ding_event content',
      'edit any ding_library content',
      'edit any ding_news content',
      'edit any ding_page content',
      'edit own audio files',
      'edit own ding_event content',
      'edit own ding_library content',
      'edit own ding_news content',
      'edit own ding_page content',
      'edit own document files',
      'edit own image files',
      'edit own video files',
      'edit terms in 2',
      'participate in workflow',
      'schedule publishing of nodes',
      'show workflow state form',
      'translate admin strings',
      'translate content',
      'translate user-defined strings',
      'use text format ding_wysiwyg',
      'view any unpublished content',
      'view bpi statistics',
      'view own unpublished content',
      'view revisions',
      'view the administration theme',
    ),
    'provider' => array(
      'access environment indicator',
      'access environment indicator development',
      'access environment indicator default_environment',
      'access environment indicator staging',
      'access environment indicator overwritten_environment',
      'create files',
      'edit own provider_alma profile',
      'edit own provider_openruth profile',
      'pay using dibs',
      'perform bookmark',
      'perform reservation',
      'view own private files',
      'view own provider_alma profile',
      'view own provider_openruth profile',
    ),
    'staff' => array(
      'access environment indicator',
      'access environment indicator development',
      'access environment indicator default_environment',
      'access environment indicator staging',
      'access environment indicator overwritten_environment',
      'edit own ding_staff_profile profile',
    ),
    'user administrator' => array(
      'access toolbar',
      'administer users',
      'administer user role 4',
      'administer user role 5',
      'administer user role 7',
      'administer user role 9',
      'edit any ding_staff_profile profile',
    ),
  );

  // Add editor specific permissions by node type,
  // using override node options module permissions.
  $node_types = node_permissions_get_configured_types();
  foreach ($node_types as $node_type) {
    if (in_array('create ' . $node_type . ' content', $permissions['editor'])) {
      $permissions['editor'][] = 'override ' . $node_type . ' promote to front page option';
    }
  }

  // Ensure that administrative users only have access to one navigation system.
  foreach ($permissions as &$role_permissions) {
    if (in_array('access administration pages', $role_permissions)) {
      // Roles with this permission should have access to Admin menu.
      $role_permissions = array_unique(array_merge($role_permissions, array('access administration menu')));
      $role_permissions = array_diff($role_permissions, array('access toolbar'));
    }
    else {
      // If the role doesn't have 'access administration pages', Admin menu is
      // useless so we can safely remove any access to it. If they role has
      // access to Toolbar it will fallback to that.
      $role_permissions = array_diff($role_permissions, array('access administration menu'));
    }
  }

  if (isset($permissions[$role])) {
    return $permissions[$role];
  }
}
